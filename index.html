<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mero Ultimate OS | Black Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000000; 
            --card: #111111; 
            --text: #ffffff; 
            --accent: #2563eb;
            --border: #222222;
        }
        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            overflow-x: hidden; 
        }
        .mero-card { 
            background: var(--card); 
            border-radius: 2rem; 
            border: 1px solid var(--border);
        }
        .nav-link.active { 
            background: var(--accent); 
            color: white; 
            box-shadow: 0 0 20px rgba(37, 99, 235, 0.3); 
        }
        .nav-link:not(.active) { color: #666; }
        .nav-link:not(.active):hover { color: #fff; background: #1a1a1a; }
        
        .timer-font { font-family: monospace; font-weight: 900; letter-spacing: -2px; }
        
        /* Custom Scrollbar for Black Mode */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        
        /* Input & SweetAlert Styles for Dark */
        input { background: #1a1a1a !important; color: white !important; border: 1px solid #333 !important; }
        .swal2-popup { background: #111 !important; color: white !important; border: 1px solid #333 !important; }
    </style>
</head>
<body class="p-0 m-0">

    <aside class="fixed right-0 top-0 h-full w-20 md:w-64 mero-card z-50 flex flex-col p-4 border-l border-zinc-800 rounded-none">
        <div class="mb-10 text-center">
            <h1 class="hidden md:block text-2xl font-black text-blue-500 italic uppercase tracking-tighter">Mero OS</h1>
            <div id="streak-badge" class="text-orange-500 font-bold text-xs mt-2">ğŸ”¥ Ø³ØªØ±ÙŠÙƒ: 0 ÙŠÙˆÙ…</div>
        </div>
        
        <nav class="space-y-3 flex-1">
            <button onclick="showPage('home')" id="nav-home" class="nav-link active w-full flex items-center gap-3 p-4 rounded-2xl font-bold transition">ğŸ  <span class="hidden md:block">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
            <button onclick="showPage('days')" id="nav-days" class="nav-link w-full flex items-center gap-3 p-4 rounded-2xl font-bold transition">âš”ï¸ <span class="hidden md:block">Ø§Ù„Ø®Ø·Ø©</span></button>
            <button onclick="showPage('backlog')" id="nav-backlog" class="nav-link w-full flex items-center gap-3 p-4 rounded-2xl font-bold transition">ğŸº <span class="hidden md:block">Ø§Ù„ØªØ±Ø§ÙƒÙ…Ø§Øª</span></button>
            <button onclick="showPage('stats')" id="nav-stats" class="nav-link w-full flex items-center gap-3 p-4 rounded-2xl font-bold transition">ğŸ“Š <span class="hidden md:block">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span></button>
        </nav>

        <div class="space-y-2 mb-4">
            <button onclick="exportData()" class="w-full p-3 text-[10px] rounded-xl bg-zinc-900 text-zinc-400 font-bold border border-zinc-800 hover:text-white transition">Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ğŸ’¾</button>
        </div>

        <div class="p-4 bg-zinc-900 border border-zinc-800 rounded-2xl text-center">
            <p id="countdown-side" class="text-xl font-black text-red-500">-- ÙŠÙˆÙ…</p>
            <p class="text-[8px] font-bold opacity-40 uppercase">Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
        </div>
    </aside>

    <main class="mr-20 md:mr-64 p-4 md:p-10 min-h-screen bg-black">
        
        <div id="page-home" class="page-content">
            <header class="mb-10 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-black italic text-white">Ø¹Ø§Ø´ ÙŠØ§ Ù…ÙŠØ±Ùˆ! ğŸš€</h2>
                    <p id="rank-label" class="text-zinc-500 font-bold text-sm">Ø§Ù„Ø±ØªØ¨Ø©: Ø¯Ø­ÙŠØ­ Ù…Ø³ØªØ¬Ø¯</p>
                </div>
                <div class="bg-blue-600 text-white p-4 rounded-2xl shadow-2xl text-center min-w-[130px]">
                    <p class="text-[10px] font-bold uppercase opacity-70 tracking-widest">Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…</p>
                    <p id="today-time-card" class="text-xl font-black italic">0 Ø³ Ùˆ 0 Ø¯</p>
                </div>
            </header>

            <div class="mero-card p-10 text-center relative overflow-hidden border-zinc-800">
                <div class="flex gap-4 justify-center mb-6">
                    <button id="pomoBtn" onclick="togglePomoMode()" class="bg-zinc-900 border border-zinc-700 text-orange-500 px-6 py-2 rounded-full font-bold text-xs hover:bg-zinc-800 transition">ÙˆØ¶Ø¹ Ø§Ù„Ù€ 50 Ø¯Ù‚ÙŠÙ‚Ø© â±ï¸</button>
                    <span id="pomo-count-display" class="bg-zinc-900 text-zinc-400 px-4 py-2 rounded-full text-xs font-bold border border-zinc-800">Ø¬Ù„Ø³Ø§Øª Ø§Ù„ÙŠÙˆÙ…: 0/10</span>
                </div>
                
                <div id="timer-display" class="timer-font text-8xl md:text-[10rem] mb-12 tabular-nums text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.1)]">00:00:00</div>
                
                <div class="flex flex-wrap gap-4 justify-center">
                    <button id="startBtn" onclick="startMeroTimer()" class="bg-blue-600 text-white px-12 py-5 rounded-3xl font-black text-xl shadow-xl hover:scale-105 transition">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø© ğŸš€</button>
                    <button id="stopBtn" onclick="resetAndStop()" class="hidden bg-red-600 text-white px-12 py-5 rounded-3xl font-black text-xl shadow-xl hover:scale-105 transition">ÙˆÙ‚Ù ÙˆØªØµÙÙŠØ± â¹ï¸</button>
                    <button onclick="finishMeroSession()" class="bg-zinc-800 text-white border border-zinc-700 px-10 py-5 rounded-3xl font-black hover:bg-green-600 transition">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² âœ…</button>
                </div>
                <p class="mt-8 text-zinc-600 text-xs italic">Ù„Ø§ ÙŠØªÙˆÙ‚Ù Ø§Ù„Ù†Ø¬Ø§Ø­ Ø£Ø¨Ø¯Ø§Ù‹ØŒ Ø§Ø³ØªÙ…Ø± ÙŠØ§ Ø¨Ø·Ù„.</p>
            </div>
        </div>

        <div id="page-days" class="hidden page-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-black italic text-white">Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ… <span id="current-day-label" class="text-blue-500">1</span></h2>
                <div class="flex gap-4">
                    <button onclick="changeDay(-1)" class="p-4 mero-card border-zinc-800 hover:bg-zinc-900">â—€ï¸</button>
                    <button onclick="changeDay(1)" class="p-4 mero-card border-zinc-800 hover:bg-zinc-900">â–¶ï¸</button>
                </div>
            </div>
            <div id="task-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"></div>
            <button onclick="addTask()" class="w-full p-6 border-2 border-dashed border-zinc-800 rounded-3xl text-zinc-600 font-black text-xl hover:border-blue-500 hover:text-blue-500 transition">+ Ø¶ÙŠÙ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„</button>
        </div>

        <div id="page-backlog" class="hidden page-content">
            <h2 class="text-3xl font-black mb-8 italic text-white">Ø­ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø§ÙƒÙ…Ø§Øª ğŸº</h2>
            <div class="mero-card p-8 border-zinc-800">
                <div class="flex gap-4 mb-8">
                    <input id="backlog-input" type="text" placeholder="Ø§ÙŠÙ‡ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù„ÙŠ ÙØ§ØªÙƒØŸ" class="flex-1 p-5 rounded-2xl outline-none focus:ring-2 ring-blue-600 transition">
                    <button onclick="addToBacklog()" class="bg-blue-600 text-white px-10 rounded-2xl font-bold">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="backlog-list" class="space-y-3"></div>
            </div>
        </div>

        <div id="page-stats" class="hidden page-content">
            <h2 class="text-3xl font-black mb-8 italic text-white">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ ğŸ“Š</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="mero-card p-8 lg:col-span-2 min-h-[400px] border-zinc-800"><canvas id="meroChart"></canvas></div>
                <div id="stats-table" class="space-y-3 max-h-[500px] overflow-y-auto"></div>
            </div>
        </div>
    </main>

    <script>
        // --- Core States ---
        let studyLog = JSON.parse(localStorage.getItem('meroStudyLog')) || {};
        let tasksStore = JSON.parse(localStorage.getItem('meroTasksStore')) || {};
        let backlog = JSON.parse(localStorage.getItem('meroBacklog')) || [];
        let pomoSessions = JSON.parse(localStorage.getItem('meroPomoSessions')) || {};
        let startTime = localStorage.getItem('meroStartTime') || null;
        let isPomo = localStorage.getItem('isPomo') === 'true';

        let activeSeconds = 0;
        let timerInterval;
        let currentDay = 1;
        let chartInstance = null;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- Navigation ---
        function showPage(p) {
            document.querySelectorAll('.page-content').forEach(pg => pg.classList.add('hidden'));
            document.getElementById(`page-${p}`).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(`nav-${p}`).classList.add('active');
            if(p === 'stats') renderStats();
            if(p === 'days') renderTasks();
            if(p === 'backlog') renderBacklog();
        }

        // --- Timer Logic ---
        function togglePomoMode() {
            if(startTime) return;
            isPomo = !isPomo;
            localStorage.setItem('isPomo', isPomo);
            activeSeconds = isPomo ? 50 * 60 : 0;
            updateTimerDisplay();
        }

        function startMeroTimer() {
            if (!startTime) {
                startTime = isPomo ? Date.now() + (50 * 60 * 1000) : Date.now();
                localStorage.setItem('meroStartTime', startTime);
            }
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('stopBtn').classList.remove('hidden');
            runTimer();
        }

        function runTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const now = Date.now();
                if(isPomo) {
                    let diff = Math.ceil((startTime - now) / 1000);
                    if(diff <= 0) { playAlarm(); handlePomoFinish(); } else { activeSeconds = diff; }
                } else {
                    activeSeconds = Math.floor((now - startTime) / 1000);
                }
                updateTimerDisplay();
            }, 1000);
        }

        function forceReset() {
            clearInterval(timerInterval);
            startTime = null;
            localStorage.removeItem('meroStartTime');
            activeSeconds = isPomo ? 50 * 60 : 0;
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('stopBtn').classList.add('hidden');
            updateTimerDisplay();
        }

        function resetAndStop() { forceReset(); }

        function handlePomoFinish() {
            const today = new Date().toLocaleDateString('en-CA');
            const dayKey = `day${currentDay}`;
            pomoSessions[dayKey] = (pomoSessions[dayKey] || 0) + 1;
            studyLog[today] = (studyLog[today] || 0) + (50 * 60);
            saveAll();
            confetti({ particleCount: 150, spread: 60, colors: ['#2563eb', '#ffffff'] });
            forceReset();
            updateDashboard();
        }

        function finishMeroSession() {
            if(isPomo || !startTime) return;
            const today = new Date().toLocaleDateString('en-CA');
            studyLog[today] = (studyLog[today] || 0) + activeSeconds;
            saveAll();
            forceReset();
            updateDashboard();
        }

        function updateTimerDisplay() {
            const h = Math.floor(activeSeconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((activeSeconds % 3600) / 60).toString().padStart(2, '0');
            const s = (activeSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${h}:${m}:${s}`;
        }

        // --- Task Management ---
        function renderTasks() {
            document.getElementById('current-day-label').innerText = currentDay;
            const tasks = tasksStore[`day${currentDay}`] || [];
            document.getElementById('task-list').innerHTML = tasks.map((t, i) => `
                <div class="mero-card p-6 flex justify-between items-center bg-zinc-900 border-zinc-800">
                    <div class="flex items-center gap-4">
                        <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${i})" class="w-6 h-6 rounded-full">
                        <span class="${t.done ? 'line-through text-zinc-600' : 'text-white'} font-bold">${t.text}</span>
                    </div>
                    <button onclick="deleteTask(${i})" class="text-zinc-700 hover:text-red-500">âœ•</button>
                </div>`).join('');
        }

        function addTask() {
            Swal.fire({ title: 'Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©', input: 'text', background: '#111', color: '#fff' }).then(res => {
                if(res.value) {
                    const key = `day${currentDay}`;
                    if(!tasksStore[key]) tasksStore[key] = [];
                    tasksStore[key].push({ text: res.value, done: false });
                    saveAll(); renderTasks();
                }
            });
        }

        function toggleTask(i) {
            tasksStore[`day${currentDay}`][i].done = !tasksStore[`day${currentDay}`][i].done;
            saveAll(); renderTasks();
            if(tasksStore[`day${currentDay}`][i].done) confetti({ particleCount: 20 });
        }

        function deleteTask(i) {
            tasksStore[`day${currentDay}`].splice(i, 1);
            saveAll(); renderTasks();
        }

        // --- Backlog ---
        function addToBacklog() {
            const el = document.getElementById('backlog-input');
            if(el.value) { backlog.push(el.value); saveAll(); renderBacklog(); el.value = ""; }
        }

        function renderBacklog() {
            document.getElementById('backlog-list').innerHTML = backlog.map((b, i) => `
                <div class="p-5 bg-zinc-900 border border-zinc-800 rounded-2xl flex justify-between items-center">
                    <span class="text-zinc-300 font-bold">${b}</span>
                    <button onclick="backlog.splice(${i},1);saveAll();renderBacklog();" class="text-blue-500 font-bold text-sm">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² âœ…</button>
                </div>`).join('');
        }

        // --- Stats & Dashboard ---
        function updateDashboard() {
            const today = new Date().toLocaleDateString('en-CA');
            const totalSecs = studyLog[today] || 0;
            document.getElementById('today-time-card').innerText = `${Math.floor(totalSecs/3600)} Ø³ Ùˆ ${Math.floor((totalSecs%3600)/60)} Ø¯`;
            updateStreak();
        }

        function updateStreak() {
            let streak = 0; let d = new Date();
            while(studyLog[d.toLocaleDateString('en-CA')] > 0) { streak++; d.setDate(d.getDate() - 1); }
            document.getElementById('streak-badge').innerText = `ğŸ”¥ Ø³ØªØ±ÙŠÙƒ: ${streak} ÙŠÙˆÙ…`;
        }

        function renderStats() {
            const ctx = document.getElementById('meroChart').getContext('2d');
            const dates = [...Array(7)].map((_, i) => { const d = new Date(); d.setDate(d.getDate() - i); return d.toLocaleDateString('en-CA'); }).reverse();
            const data = dates.map(d => (studyLog[d] || 0) / 3600);
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: dates, datasets: [{ data: data, borderColor: '#2563eb', tension: 0.4, fill: true, backgroundColor: 'rgba(37,99,235,0.05)' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#222' } }, x: { grid: { color: '#222' } } } }
            });
        }

        function saveAll() {
            localStorage.setItem('meroStudyLog', JSON.stringify(studyLog));
            localStorage.setItem('meroTasksStore', JSON.stringify(tasksStore));
            localStorage.setItem('meroBacklog', JSON.stringify(backlog));
            localStorage.setItem('meroPomoSessions', JSON.stringify(pomoSessions));
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(localStorage)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `MeroOS_Backup.json`; a.click();
        }

        function playAlarm() {
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(440, audioCtx.currentTime);
            osc.start(); osc.stop(audioCtx.currentTime + 1);
        }

        function changeDay(offset) {
            currentDay = Math.max(1, Math.min(135, currentDay + offset));
            renderTasks();
        }

        // --- Init ---
        function init() {
            const examDate = new Date('2026-06-20');
            const remain = Math.ceil((examDate - new Date()) / 86400000);
            document.getElementById('countdown-side').innerText = Math.max(0, remain) + ' ÙŠÙˆÙ…';
            if(startTime) runTimer();
            updateDashboard();
            renderTasks();
            renderBacklog();
        }
        init();
    </script>
</body>
</html>